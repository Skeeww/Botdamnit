import Pusher from "pusher";
import { client } from "../main";
import { Config } from "../utils/config";

export namespace Mod {
    const pusher = new Pusher({
        appId: Config.PUSHER_APP_ID,
        key: Config.PUSHER_API_KEY,
        secret: Config.PUSHER_APP_SECRET,
        cluster: Config.PUSHER_REGION,
        useTLS: true
    })

    client.on("messageCreate", (msg) => {
        pusher.trigger("discordmod", "message", JSON.stringify({
            message: msg,
            channelinfo: client.getChannel(msg.channel.id)
        }))
    })
    pusher.trigger("discordmod", "meta", client.guilds.get(Config.GUILD_ID)?.members.filter(m => m.status === "online" || m.status === "dnd").length)
    setInterval(() => {
        pusher.trigger("discordmod", "meta", client.guilds.get(Config.GUILD_ID)?.members.filter(m => m.status === "online" || m.status === "dnd").length)
    }, 60000);
}